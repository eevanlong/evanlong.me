---
title: SQL查询
---

# SQL 查询

## 简单查询

**语法**

```sql
select 列名1 别名1,列名2 别名2... from 表名;
```

 例：查询员工的姓名

```sql
select ename from emp;
```

 例：查询员工的编号、姓名、工作

```sql
select empno,ename,job from emp;
```

 例：查询员工的所有信息

```sql
select * from emp;
select empno,ename,job,mgr,hiredate,sal,comm,deptno from emp;
```

 例：查询员工的姓名、工资、入职时间，并为每列设置别名

```sql
select ename 姓名,sal 工资,hiredate 入职时间 from emp;
```

 例：查询雇员姓名及年薪

```sql
select ename,(sal+comm)*12 from emp; -- NULL参与任何运算时，结果都为NULL
-- ifnull(a,b)函数，如a不为null，则返回a，否则返回b
select ename,(sal+ifnull(comm,0))*12 income from emp;
```

 例：查询所有的职位

```sql
select distinct job from emp; -- 使用distinct去除重复行
```

## 限定查询

**语法**

```sql
select *|列名1 别名1,列名2 别名2...
from 表名
where 条件;
```

### 比较运算符

 >、<、>=、<=、=、!=

 例：查询工资大于 1500 的雇员信息

```sql
select * from emp where sal>1500;
```

 例：查询雇员的编号不是 7369 的雇员信息

```sql
select * from emp where empno!=7369;
```

 例：查询姓名是 smith 的雇员编号、姓名、工资、入职时间

```sql
select empno,ename,sal,hiredate from emp where ename='smith'; --  字符串要使用引号起来
```

### null 和 not null

 例：查询每月有奖金的雇员信息

```sql
select * from emp where comm is not null; -- 判断是否为null时，使用的是is，不能使用比较运算符
```

### and

 例：查询基本工资大于 1500，同时可以获得奖金的雇员姓名、工资和奖金

```sql
select ename,sal,comm from emp where sal>1500 and comm is not null;
```

### or

 例：查询从事销售工作，或工资大于等于 2000 的雇员信息

```sql
select * from emp where job='salesman' or sal>=2000;
```

### not

 例：查询从事非销售工作，并且工资不小于 1500 的雇员信息

```sql
select * from emp where job!='salesman' and sal>=1500;
select * from emp where not job='salesman' and not sal<1500;
```

 例：查询**从事销售工作，并且工资小于 1500**以外的雇员信息

```sql
select * from emp where not (job='salesman' and sal<1500);
```

### between and

 例：查询基本工资大于 1500，但小于 3000 的雇员信息

```sql
select * from emp where sal>1500 and  sal<3000;
select * from emp where sal between 3000 and 1500;
-- 1.包含临界值
-- 2.
```

 例：查询 1981 年入职的雇员编号、姓名、入职时间、所在部门编号

```sql
select empno,ename,hiredate,deptno from emp where hiredate between '1981-1-1' and '1981-12-31';
```

### in 和 not in

 例：查询编号为 7788、7499、7369 的雇员信息

```sql
select * from emp where empno=7788 or empno=7499 or empno=7369;
select * from emp where empno not in (7788,7499,7369);
```

 例：查询姓名为 SMITH、ALLEN、KING 的雇员编号、姓名、入职时间

```sql
select empno 编号,ename 姓名,hiredate 入职时间 from emp where ename in ('smith','allen','king');
```

### like

 用来进行模糊查询，需要结合**通配符**一起使用

 常用通配符：

- % 可以匹配任意长度字符
- \_ 可以匹配单个字符

 例：查询雇员姓名以 S 开头的雇员信息

```sql
select * from emp where ename like 's%';
```

 例：查询雇员姓名中包含 M 的雇员信息

```sql
select * from emp where ename like '%m%';
```

 例：查询 1981 年入职的雇员编号、姓名、入职时间、所在部门编号

```sql
select empno,ename,hiredate,deptno from emp where hiredate like '1981%';
```

 例：查询姓名以 D 结尾，长度为 4 个字符的雇员信息

```sql
select * from emp where ename like '___d';
```

### 排序

**语法**

```sql
select *|列名1 别名1,列名2 别名2...
from 表名
where 条件
order by 排序列1 asc|desc,排序列2 asc|desc;
```

::: tip

asc 表示升序，desc 表示降序，如果省略不写，则默认为升序

:::

 例：查询所有雇员信息，按工资由低到高排序

```sql
select * from emp order by sal asc;
```

 例：查询所有雇员信息，按工资由高到低排序，如果工资相同，则按入职时间由早到晚排序

```sql
select * from emp order by sal desc,hiredate asc;
```

 例：查询部门 10 的雇员信息，按工资降序排列

```sql
select * from emp where deptno=10 order by sal desc;
```

 例：查询雇员编号、姓名、年薪，按年薪由高到低排序

```sql
select empno,ename,(sal+ifnull(comm,0))*12 income from emp order by income desc;
```

## 多表查询

::: tip

同时从多张表中查询数据，一般来说多张表之间都会存在某种关系

:::

**语法**

```sql
select *|列名1 别名1,列名2 别名2...
from 表名1 别名1,表名2 别名2
where 条件
order by 排序列1 asc|desc,排序列2 asc|desc
```

 例：将 emp 表和 dept 表进行多表查询（笛卡尔积）

```sql
select * from emp,dept;
```

 例：通过将两张表的关联字段进行比较，去掉笛卡尔积，多表查询时一般都会存在某种关系

```sql
select * from emp,dept where emp.deptno=dept.deptno;
```

 例：为表起别名，简化操作

```sql
-- 当查询的列在多张表中都出现时，此时必须添加表名作为前缀
select e.ename,e.sal,d.deptno,d.dname,d.loc
from emp e,dept d
where e.deptno=d.deptno;
```

 例：查询雇员编号、雇员姓名、工资、所在部门名称及位置（等值连接）

```sql
select e.empno 雇员编号,e.ename 雇员姓名,e.sal 工资,d.dname 部门名称,d.loc 部门位置
from emp e,dept d
where e.deptno=d.deptno;
```

 例：查询雇员姓名、雇员工资、领导姓名、领导工资（自身连接）

```sql
select e.ename 雇员姓名,e.sal 雇员工资,m.ename 领导姓名,m.sal 领导工资
from emp e,emp m
where e.mgr=m.empno;
```

 例：查询雇员姓名、雇员工资、部门名称、领导姓名、领导工资

```sql
select e.ename 雇员姓名,e.sal 雇员工资,d.dname 部门名称,m.ename 领导姓名,m.sal 领导工资
from emp e,dept d,emp m
where e.deptno=d.deptno and e.mgr=m.empno;
```

 例：查询雇员姓名、雇员工资、部门名称、工资所在等级（非等值连接）

```sql
select e.ename 雇员姓名,e.sal 雇员工资,d.dname 部门名称,s.grade 工资等级
from emp e,dept d,salgrade s
where e.deptno=d.deptno and e.sal between s.losal and s.hisal;
```

## 子查询

::: tip

 一个查询中嵌套着另一个查询，称为子查询

- 子查询必须放在小括号()中
- 子查询可以出现在任意位置，如 select、from、where、having 等位置
- 子查询一般作为条件，适合于操作单表的数据，灵活、方便
- 多表连接查询一般适合于查看多表的数据

:::

**语法**

```sql
select (子查询)
from (子查询) 别名
where (子查询)
group by
having (子查询)
```

 例：查询工资比 7566 高的雇员信息

```sql
select sal from emp where empno=7566;

select * from emp where sal > (
  select sal from emp where empno=7566
);
```

 例：查询工资比部门 20 员工的工资高的雇员信息

```sql
select sal from emp where deptno=20;

select * from emp where sal > all (
  select sal from emp where deptno=20
);


select * from emp where sal > any (
  select sal from emp where deptno=20
);
```

 例：查询雇员编号、姓名、部门名称（分别使用多表连接和子查询实现）

```sql
select e.empno,e.ename,d.dname
from emp e,dept d
where e.deptno=d.deptno;

select empno,ename,(select dname from dept where deptno=emp.deptno) dname
from emp;
```

## SQL99 标准

::: tip
​
SQL99 标准，也称为 SQL1999 标准，是 1999 年制定的标准

 分类：内连接、外连接

:::

### 内连接

 使用**inner join...on**

 语法：

```sql
select *|列名1 别名1,列名2 别名2...
from 表名1 别名1 inner join 表名2 别名2 on 多表间的关联关系
where 条件
order by 排序列1 asc|desc,排序列2 asc|desc;
```

 例：查询雇员编号、雇员姓名、工资、部门名称

```sql
select e.empno,e.ename,e.sal,d.dname
from emp e,dept d
where e.deptno=d.deptno;

select e.empno,e.ename,e.sal,d.dname
from emp e inner join dept d on e.deptno=d.deptno;
```

 例：查询工资大于 1500 的雇员姓名、工资、所在部门名称、领导姓名

```sql
select e.ename 雇员姓名,e.sal 工资,d.dname 部门名称,m.ename 领导姓名
from emp e
  inner join dept d
    on e.deptno=d.deptno
  inner join emp m
    on e.mgr=m.empno
where e.sal>1500;
```

### 外连接

 分类：

- 左外连接 left outer join...on，也称为左连接 left join...on
  以左边的表作为主表，无论如何都会显示主表中的所有数据
- 右外连接 right outer join...on，也称为右连接 right join...on
  以右边的表作为主表，无论如何都会显示主表中的所有数据

**语法**

```sql
select *|列名1 别名1,列名2 别名2...
from 表名1 别名1 left outer join 表名2 别名2 on 多表间的关联关系
where 条件
order by 排序列1 asc|desc,排序列2 asc|desc;
```

 例：查询雇员姓名、工资、领导姓名、领导工资（有的雇员没有领导）

```sql
select e.ename 雇员姓名,e.sal 雇员工资,m.ename 领导姓名,m.sal 领导工资
from emp e,emp m
where e.mgr=m.empno; -- 有问题的

select e.ename 雇员姓名,e.sal 雇员工资,m.ename 领导姓名,m.sal 领导工资
from emp e inner join emp m  on  e.mgr=m.empno; -- 有问题的

select e.ename 雇员姓名,e.sal 雇员工资,m.ename 领导姓名,m.sal 领导工资
from emp e left join emp m  on  e.mgr=m.empno;

select e.ename 雇员姓名,e.sal 雇员工资,m.ename 领导姓名,m.sal 领导工资
from emp m right join emp e  on  e.mgr=m.empno;
```

 例：查询部门编号、部门名称、部门位置、部门中的雇员姓名、工资

```sql
select d.deptno,d.dname,d.loc,e.ename,e.sal
from dept d left join emp e on d.deptno=e.deptno
order by d.deptno;
```

## 聚合函数查询

 聚合函数，也称为统计函数

 常用的聚合函数：

- count() 总数量
- max() 最大值
- min() 最小值
- sum() 总和
- avg() 平均数

 例：查询部门 30 的总人数

```sql
select count(empno) from emp where deptno=30;
```

 例：查询部门 30 的最高工资、最低工资、平均工资

```sql
select max(sal),min(sal),avg(sal),sum(sal) from emp where deptno=30;
```

## 分组统计查询

**语法**

```sql
select *|列名1 别名1,列名2 别名2...
from 表名1 别名1 left outer join 表名2 别名2 on 多表间的关联关系
where 分组前的条件
group by 分组列
having 分组后的条件
order by 排序列1 asc|desc,排序列2 asc|desc
```

 例：查询每个部门的平均工资

```sql
-- 使用round(a,b)进行四舍五入
select deptno 部门编号,round(avg(sal),2)  平均工资
from emp
group by deptno;
```

 例：查询每个部门的名称、位置、平均工资

```sql
select d.dname 部门名称,d.loc 部门位置,avg(e.sal) 平均工资
from dept d left join emp e on d.deptno=e.deptno
group by d.dname;
```

 例：查询部门的名称及每个部门的员工数量（使用外连接）

```sql
select d.dname 部门名称,count(e.empno) 员工数量
from emp e right join dept d on e.deptno=d.deptno
group by d.dname;
```

 例：查询平均工资大于 2000 的部门的编号和平均工资

```sql
select deptno,avg(sal)
from emp
group by deptno
having avg(sal)>2000;
```

## 常用函数查询

### 字符串函数

 concat(s1,s2,s3,.....) 拼接字符串

```sql
select concat('aaa','bbb','ccc') from dual;
```

 lower(s) 将字符串变成小写

```sql
select lower('Hello World') from dual;
```

 upper(s) 将字符串变成大写

```sql
select upper('Hello World') from dual;
select upper(ename) from emp;
-- 让字符串的首字母大写
select upper(substr(ename,1,1))  from emp;
select lower(substr(ename,2,length(ename)-1))  from emp;
select concat(upper(substr(ename,1,1)),lower(substr(ename,2,length(ename)-1))) 姓名  from emp;
```

 length(s) 获取字符串的长度

```sql
select length('hello world') from dual;
select ename 姓名,length(ename) 长度 from emp;
```

 substr(s,i,len) 对字符串 s 进行截取，从索引为 i 的位置开始截取，截取长度为 len

```sql
select substr('hello world',2,3) from dual; -- 索引从1开始
```

 reverse(s) 将字符串反转

```sql
select reverse('welcome') from dual;
```

 replace(s,s1,s2) 将字符串 s 中的 s1 替换为 s2

```sql
select replace('hello world','o','x') from dual;
```

 password(s) 对字符串 s 进行加密，一般用于用户注册时对密码进行加密处理

```sql
select password('123456') from dual; -- 使用散列hash算法，单向
```

**注：dual 表是 MySQL 提供的一张虚拟表，主要是为了满足 select..from...语法习惯，一般测试时使用，无实际意义**

### 数值函数

 ceil(n) 返回大于 n 的最小整数

```sql
select ceil(1.4) from dual;
```

 floor(n) 返回小于 n 的最大整数

```sql
select floor(1.4) from dual;
```

 round(n,y) 将 n 保留 y 位小数，四舍五入

```sql
select round(1.234567,3) from dual;
```

 truncate(n,y) 将 n 保留 y 位小数，不四舍五入

```sql
select truncate(1.234567,3) from dual;
```

 rand() 返回 [0,1) 之间的随机小数

```sql
select rand() from dual;
```

### 日期和时间函数

 now() 返回当前日期时间

```sql
select now() from dual;
```

 curdate() 返回当前日期 current

```sql
select curdate() from dual;
```

 curtime() 返回当前时间

```sql
select curtime() from dual;
```

 year(date) 返回日期中的年

```sql
select year('2020-2-14') from dual;
-- 查询1986年入职的员工信息
select * from emp where year(hiredate)=198;
```

 month(date) 返回日期中的月

```sql
select month('2020-2-14') from dual;
```

 day(date) 返回日期中的日

```sql
select day('2020-2-14') from dual;
```

### 流程控制函数

 if(f,v1,v2) 如果 f 为真，则返回 v1，否则返回 v2

```sql
select if(5>2,'yes','no') from dual;
select ename,if(sal>=3000,'你很棒','继续努力') 评价 from emp;
```

 ifnull(v1,v2) 如果 v1 不为 null，则返回 v1，否则返回 v2

```sql
select ename,ifnull(comm,0) 奖金 from emp;
```
